# è·¨èŠ‚ç‚¹æµ‹è¯•é…ç½®ç¤ºä¾‹
# ç”¨äºæµ‹è¯• Mooncake åœ¨ä¸åŒ vLLM å®ä¾‹é—´ä¼ è¾“ KV Cache çš„èƒ½åŠ›

# =============================================================================
# OpenAI å…¼å®¹æ¥å£é…ç½®
# =============================================================================
openai_api:
  # é»˜è®¤ API åœ°å€ï¼ˆå¯ä»¥ä¸é…ç½®ï¼Œå› ä¸ºä¼šæŒ‰è½®æ¬¡ä½¿ç”¨ä¸åŒ endpointï¼‰
  base_url: "http://10.220.143.34:8080/v1"
  api_key: "dummy"
  model_name: "Qwen2.5-72B-Instruct"

  # ğŸŒ è·¨èŠ‚ç‚¹æµ‹è¯•é…ç½®ï¼ˆå…³é”®ï¼ï¼‰
  # Round 1: ä½¿ç”¨èŠ‚ç‚¹ Aï¼ˆå­˜å‚¨ KV Cache åˆ° Mooncakeï¼‰
  # Round 2: ä½¿ç”¨èŠ‚ç‚¹ Bï¼ˆä» Mooncake åŠ è½½ KV Cacheï¼‰
  endpoints_per_round:
    1: "http://10.220.143.34:8080/v1"    # èŠ‚ç‚¹ A - vLLM å‰¯æœ¬ 1
    2: "http://10.220.144.133:8080/v1"    # èŠ‚ç‚¹ B - vLLM å‰¯æœ¬ 2

# =============================================================================
# Mooncake é…ç½®
# =============================================================================
mooncake:
  # Mooncake Master åœ°å€ï¼ˆæ‰€æœ‰å‰¯æœ¬å¿…é¡»è¿æ¥åˆ°åŒä¸€ä¸ª Masterï¼‰
  master_ip: "s-20251110120529-zazrws.aistudio-kic"
  master_port: 50001
  metadata_port: 8080
  metrics_port: 9003
  prometheus_url: "http://s-20251110120529-zazrws.aistudio-kic:9003"


# =============================================================================
# æµ‹è¯•æ¨¡å‹é…ç½®
# =============================================================================
model:
  name: "Qwen/Qwen2.5-72B-Instruct"
  max_tokens: 128
  temperature: 0.0
  size: "72B"

# =============================================================================
# æµ‹è¯•åœºæ™¯é…ç½®
# =============================================================================
test_scenarios:
  # åœºæ™¯ 1: é•¿ä¸Šä¸‹æ–‡é«˜é‡ç”¨
  long_context_high_reuse:
    description: "é•¿æ–‡æ¡£åˆ†æï¼Œå¤šä¸ªé—®é¢˜å…±äº«ç›¸åŒçš„é•¿ä¸Šä¸‹æ–‡"
    num_requests: 10
    context_length: 4096  # 16k tokens
    reuse_ratio: 0.9  # 90% é‡ç”¨ç‡
    questions:
      - "è¯·æ€»ç»“æ–‡æ¡£çš„æ ¸å¿ƒè¦ç‚¹"
      - "æ–‡æ¡£ä¸­æåˆ°äº†å“ªäº›å…³é”®æŠ€æœ¯"
      - "å¦‚ä½•åº”ç”¨è¿™äº›æŠ€æœ¯"
      - "æœ‰å“ªäº›æ€§èƒ½ä¼˜åŒ–å»ºè®®"
      - "æ–‡æ¡£çš„ä¸»è¦ç»“è®ºæ˜¯ä»€ä¹ˆ"

  # åœºæ™¯ 2: å¤šè½®å¯¹è¯
  multi_turn_conversation:
    description: "æ¨¡æ‹Ÿå¤šè½®å¯¹è¯ï¼Œé€æ­¥ç´¯ç§¯ä¸Šä¸‹æ–‡"
    num_requests: 10
    reuse_ratio: 0.85
    conversation_turns:
      - "è¯·ä»‹ç»ä¸€ä¸‹å¤§è¯­è¨€æ¨¡å‹çš„åŸºæœ¬åŸç†"
      - "Transformer æ¶æ„æ˜¯å¦‚ä½•å·¥ä½œçš„"
      - "æ³¨æ„åŠ›æœºåˆ¶çš„å…·ä½“å®ç°æ˜¯ä»€ä¹ˆ"
      - "å¦‚ä½•è¿›è¡Œæ¨¡å‹è®­ç»ƒ"
      - "æ¨ç†é˜¶æ®µæœ‰å“ªäº›ä¼˜åŒ–æŠ€æœ¯"

  # åœºæ™¯ 3: ä»£ç ç”Ÿæˆ
  code_generation:
    description: "ä»£ç ç”Ÿæˆä»»åŠ¡ï¼Œå…±äº«ä»£ç åº“ä¸Šä¸‹æ–‡"
    num_requests: 10
    context_length: 4096
    reuse_ratio: 0.8
    tasks:
      - "å®ç°ä¸€ä¸ªæ–°çš„ä¼˜åŒ–å™¨"
      - "æ·»åŠ åˆ†å¸ƒå¼è®­ç»ƒæ”¯æŒ"
      - "å®ç°æ¨¡å‹æ£€æŸ¥ç‚¹ä¿å­˜"
      - "æ·»åŠ æ€§èƒ½ç›‘æ§ä»£ç "

  # åœºæ™¯ 4: æ‰¹é‡å¤„ç†
  batch_processing:
    description: "æ‰¹é‡å¤„ç†ä»»åŠ¡ï¼Œå…±äº«æŒ‡ä»¤æ¨¡æ¿"
    num_requests: 10
    reuse_ratio: 0.95
    instruction_length: 1500  # æŒ‡ä»¤æ¨¡æ¿é•¿åº¦

  # åœºæ™¯ 5: å†·å¯åŠ¨ï¼ˆæ— ç¼“å­˜é‡ç”¨ï¼‰
  cold_start:
    description: "å†·å¯åŠ¨åœºæ™¯ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½æ˜¯å”¯ä¸€çš„"
    num_requests: 10
    reuse_ratio: 0.0
    content_length: 2000

# =============================================================================
# æµ‹è¯•æ‰§è¡Œé…ç½®
# =============================================================================
test_execution:
  rounds: 2  # Round 1: èŠ‚ç‚¹ A, Round 2: èŠ‚ç‚¹ B

  # âš ï¸  è·¨èŠ‚ç‚¹æµ‹è¯•ï¼šæ¯æ¬¡åªé…ç½®ä¸€ä¸ªåœºæ™¯ï¼
  default_scenarios:
    - long_context_high_reuse
    # - multi_turn_conversation  # æ³¨é‡Šæ‰ï¼æµ‹è¯•å®Œç¬¬ä¸€ä¸ªåœºæ™¯åï¼Œæ‰‹åŠ¨æ¸…ç†ç¼“å­˜ï¼Œå†æµ‹è¯•è¿™ä¸ª

  concurrency: null
  wait_between_rounds: 15
  request_timeout: 300

# =============================================================================
# æ€§èƒ½ç›®æ ‡
# =============================================================================
performance_targets:
  cache_hit:
    ttft_reduction_percent: 60  # TTFT é™ä½è‡³å°‘ 60%
    throughput_increase_percent: 150  # ååé‡æå‡è‡³å°‘ 150%

  warning:
    ttft_reduction_percent: 30
    throughput_increase_percent: 50

# =============================================================================
# è¾“å‡ºé…ç½®
# =============================================================================
output:
  results_dir: "test_results"
  reports_dir: "reports"
  save_detailed: true
  auto_generate_report: true
  report_formats:
    - markdown
    - html
  generate_charts: true

# =============================================================================
# ç›‘æ§é…ç½®
# =============================================================================
monitoring:
  enabled: true
  interval: 5
  mooncake_metrics:
    - "master_key_count"
    - "master_allocated_bytes"
    - "master_put_start_requests_total"
    - "master_get_replica_list_requests_total"

# =============================================================================
# æ—¥å¿—é…ç½®
# =============================================================================
logging:
  level: "INFO"
  log_file: "logs/test_{timestamp}.log"
  console_output: true

# =============================================================================
# è·¨èŠ‚ç‚¹æµ‹è¯•è¯´æ˜
# =============================================================================
#
# å·¥ä½œæµç¨‹ï¼š
# 1. Round 1 åœ¨èŠ‚ç‚¹ A (10.237.65.81) æ‰§è¡Œ
#    - vLLM ç”Ÿæˆ KV Cache
#    - KV Cache å­˜å‚¨åˆ° Mooncake
#
# 2. ç­‰å¾… 5 ç§’ï¼ˆwait_between_roundsï¼‰
#
# 3. Round 2 åœ¨èŠ‚ç‚¹ B (10.237.65.95) æ‰§è¡Œ
#    - vLLM ä» Mooncake åŠ è½½ KV Cache
#    - é€šè¿‡ RDMA è·¨èŠ‚ç‚¹ä¼ è¾“
#
# é¢„æœŸç»“æœï¼š
# - TTFT é™ä½ â‰¥60%ï¼ˆè¯´æ˜æˆåŠŸåŠ è½½äº†ç¼“å­˜ï¼‰
# - ååé‡æå‡ â‰¥150%
#
# éªŒè¯è¦ç‚¹ï¼š
# - ä¸¤ä¸ªèŠ‚ç‚¹å¿…é¡»éƒ½é…ç½®äº† LMCache è¿æ¥ Mooncake
# - ä¸¤ä¸ªèŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ç›¸åŒçš„ model å’Œ kv_role="kv_both"
# - Mooncake é›†ç¾¤å¿…é¡»æ­£å¸¸è¿è¡Œ
# - ç½‘ç»œå¿…é¡»æ”¯æŒ RDMAï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰
#
# =============================================================================
