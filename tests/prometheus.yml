# Prometheus 配置文件 - Mooncake 测试

global:
  scrape_interval: 5s  # 每 5 秒抓取一次指标
  evaluation_interval: 5s  # 每 5 秒评估一次规则
  scrape_timeout: 4s

  external_labels:
    monitor: 'mooncake-cache-test'
    environment: 'test'

# 规则文件
rule_files:
  # - "rules/*.yml"

# 抓取配置
scrape_configs:
  # Mooncake Master 指标
  - job_name: 'mooncake-master'
    static_configs:
      - targets: ['mooncake-master:9004']
        labels:
          service: 'mooncake-master'
          role: 'cache-storage'

  # vLLM Prefiller 指标（如果 vLLM 暴露 Prometheus 指标）
  - job_name: 'vllm-prefiller'
    static_configs:
      - targets: ['vllm-prefiller:8100']
        labels:
          service: 'vllm-prefiller'
          role: 'prefill'
    metrics_path: '/metrics'

  # vLLM Decoder 指标
  - job_name: 'vllm-decoder'
    static_configs:
      - targets: ['vllm-decoder:8200']
        labels:
          service: 'vllm-decoder'
          role: 'decode'
    metrics_path: '/metrics'

  # vLLM 单服务指标（非 PD 分离模式）
  - job_name: 'vllm-server'
    static_configs:
      - targets: ['vllm-server:8000']
        labels:
          service: 'vllm-server'
          role: 'serving'
    metrics_path: '/metrics'

  # Prometheus 自身指标
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'
          role: 'monitoring'

# 告警配置（可选）
alerting:
  alertmanagers:
    - static_configs:
        - targets: []
          # - 'alertmanager:9093'
